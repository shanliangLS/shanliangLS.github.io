<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Docker 安装与入门 | 钐椋的博客</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.2.0"></head><body><header><nav><a href="/">首页</a><a href="/archives/">归档</a></nav></header><main><article><div id="post-bg"><div id="post-title"><div id="post-info"><span>date:<time datetime="2022-10-09T00:54:00.000Z" id="date"> 2022-10-09</time></span><br><span>updated:<time datetime="2022-10-10T01:26:53.811Z" id="updated"> 2022-10-10</time></span></div><h1>Docker 安装与入门</h1><hr></div><div id="post-content"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="在线安装"><a href="#在线安装" class="headerlink" title="在线安装"></a>在线安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y yum-utils device-mapper-persistent-data lvm2<br>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<br>yum install -y docker-ce<br></code></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">service docker start<br>service docker status<br></code></pre></td></tr></table></figure>

<h3 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h3><p>下载安装包，可访问网址查看最新版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker安装包下载</span><br>https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-18.09.8-3.el7.x86_64.rpm<br><br><span class="hljs-comment"># 依赖包下载</span><br><span class="hljs-comment"># containerd.io</span><br>https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.2-3.el7.x86_64.rpm<br><span class="hljs-comment"># docker-ce-cli</span><br>https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-cli-18.09.8-3.el7.x86_64.rpm<br><span class="hljs-comment"># container-selinux</span><br>https://pkgs.org/download/container-selinux<br></code></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpm -Uvh --force --nodeps *.rpm<br></code></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">service docker start<br>service docker status<br></code></pre></td></tr></table></figure>

<h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h4><p>下载，可访问网址查看最新版本<br><code>$(uname -s)</code> 即系统名称（Linux），<code>(uname -m)</code> 即系统架构（x86_64）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 这个是官方地址，可能比较慢，推荐使用下面的国内镜像地址</span><br>curl -L <span class="hljs-string">&quot;https://github.com/docker/compose/releases/download/2.11.2/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="hljs-built_in">local</span>/bin/docker-compose<br><br><span class="hljs-comment"># 国内镜像地址</span><br>curl -L https://get.daocloud.io/docker/compose/releases/download/2.11.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="hljs-built_in">local</span>/bin/docker-compose<br><br><span class="hljs-comment"># 下载完之后可以看下 /usr/local/bin 这个目录有没有 docker-compose 这个文件</span><br></code></pre></td></tr></table></figure>

<p>授权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 给docker compose 目录授权</span><br>sudo chmod +x /usr/<span class="hljs-built_in">local</span>/bin/docker-compose<br><br><span class="hljs-comment"># 查看一下version，显示有版本号那就说明安装成功了</span><br>docker-compose version<br></code></pre></td></tr></table></figure>

<h3 id="启动异常"><a href="#启动异常" class="headerlink" title="启动异常"></a>启动异常</h3><h4 id="OCI-runtime-create-failed"><a href="#OCI-runtime-create-failed" class="headerlink" title="OCI runtime create failed"></a>OCI runtime create failed</h4><p>启动镜像时报</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker: Error response from daemon: failed to create shim: OCI runtime create failed: unable to retrieve OCI runtime error (open /run/containerd/io.containerd.runtime.v2.task/moby/cdf3729f103e2f4cb94e25f3cfe6c21a3126428c0a977b7651ed5a77ab6d7/log.json: no such file or directory): runc did not terminate successfully: unknown.<br></code></pre></td></tr></table></figure>

<p>下载 <a target="_blank" rel="noopener" href="https://github.com/opencontainers/runc/tags">runc</a> 替换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">cp runc.amd64 /usr/<span class="hljs-built_in">local</span>/bin/runc<br>cp runc.amd64 /usr/<span class="hljs-built_in">local</span>/sbin/runc<br>cp runc.amd64 /usr/bin/runc<br>chmod +x /usr/<span class="hljs-built_in">local</span>/bin/runc<br>chmod +x /usr/<span class="hljs-built_in">local</span>/sbin/runc<br>chmod +x /usr/bin/runc<br></code></pre></td></tr></table></figure>

<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><h3 id="下载镜像到本地"><a href="#下载镜像到本地" class="headerlink" title="下载镜像到本地"></a>下载镜像到本地</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull &lt;repository&gt;:&lt;tag&gt; <span class="hljs-comment"># 必须先pull镜像到本地</span><br>docker save &lt;repository&gt;:&lt;tag&gt; -o &lt;repository&gt;.tar <span class="hljs-comment"># 保存为tar包</span><br></code></pre></td></tr></table></figure>

<p>直接使用 IMAGE ID 保存，导入后 repository 和 tag 名称会显示 none</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker save &lt;IMAGE ID&gt; -o &lt;repository&gt;.tar <span class="hljs-comment"># 会导致载入镜像后名字标签都为&lt;none&gt;</span><br></code></pre></td></tr></table></figure>

<p>如果 docker 载入新的镜像后 repository 和 tag 都为 none，那么通过 tag 的方法增加名字标签</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker tag &lt;IMAGE ID&gt; &lt;repository&gt;:&lt;tag&gt;<br></code></pre></td></tr></table></figure>

<h3 id="载入镜像"><a href="#载入镜像" class="headerlink" title="载入镜像"></a>载入镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker load --input &lt;repository&gt;.tar<br></code></pre></td></tr></table></figure>

<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker rmi -f &lt;IMAGE ID&gt;<br></code></pre></td></tr></table></figure>

<p><code>-f</code> 表示强制删除镜像</p>
<h3 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a>导出镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker save [options] images [images...]<br></code></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker save mongo:latest -o mongo.tar<br>或 <br>docker save mongo:latest &gt; mongo.tar<br></code></pre></td></tr></table></figure>

<p><code>-o</code> 和 <code>&gt;</code> 表示输出到文件，<code>nginx:latest</code> 是源镜像名（name:tag），也可以用镜像 ID</p>
<p>导出多个镜像到一个tar包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker save $(docker images | grep -v REPOSITORY | awk <span class="hljs-string">&#x27;BEGIN&#123;OFS=&quot;:&quot;;ORS=&quot; &quot;&#125;&#123;print $1,$2&#125;&#x27;</span>) -o kube.tar<br></code></pre></td></tr></table></figure>

<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker load [options]<br></code></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bsah">docker load -i mongo.tar<br>或<br>docker load &lt; mongo.tar<br></code></pre></td></tr></table></figure>

<p><code>-i</code> 和 <code>&lt;</code> 表示从文件输入。会成功导入镜像及相关元数据，包括 tag 信息</p>
<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><div id="paginator"></div></div><div id="post-footer"><hr><a href="/2022/10/10/Git-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">← Prev Git 常用命令</a><span style="color: #fe2"> | </span><a href="/2022/09/01/Nginx-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">Nginx 安装与配置 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/shanliangLS"> Dr.Shining</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">31</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">22</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">7</span></div></section></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">在线安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">离线安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-compose"><span class="toc-number">1.2.1.</span> <span class="toc-text">docker-compose</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8"><span class="toc-number">1.3.</span> <span class="toc-text">启动异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OCI-runtime-create-failed"><span class="toc-number">1.3.1.</span> <span class="toc-text">OCI runtime create failed</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F"><span class="toc-number">2.</span> <span class="toc-text">镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="toc-number">2.1.</span> <span class="toc-text">下载镜像到本地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%BD%E5%85%A5%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.</span> <span class="toc-text">载入镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-number">2.3.</span> <span class="toc-text">删除镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E9%95%9C%E5%83%8F"><span class="toc-number">2.4.</span> <span class="toc-text">导出镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F"><span class="toc-number">2.5.</span> <span class="toc-text">导入镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">容器</span></a></li></ol></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">github.com/shanliangLS</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>